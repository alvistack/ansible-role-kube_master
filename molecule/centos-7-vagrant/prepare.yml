---

# (c) Wong Hoi Sing Edison <hswong3i@pantarei-design.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- name: Prepare
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Install some basic packages because vagrant machines maybe bare
      raw: |
        if [ -x "$(command -v apt-get)" ]
        then
          apt-get update && apt-get install -y ca-certificates curl python sudo
        elif [ -x "$(command -v yum)" ]
        then
          yum install -y ca-certificates curl python sudo
        elif [ -x "$(command -v zypper)" ]
        then
          zypper -n --gpg-auto-import-keys refresh && zypper -n install -y ca-certificates ca-certificates-cacert ca-certificates-mozilla curl python python-xml sudo
        elif [ -x "$(command -v apk)" ]
        then
          apk update && apk add ca-certificates curl python sudo
        elif [ -x "$(command -v pacman)" ]
        then
          pacman -Syu --noconfirm ca-certificates curl python2 sudo
        elif [ -x "$(command -v dnf)" ]
        then
          dnf --assumeyes install ca-certificates curl python python-devel python2-dnf sudo
        elif [ -x "$(command -v emerge)" ]
        then
          emerge --ask n ca-certificates curl dev-lang/python-2 gentoolkit sudo
        fi
      changed_when: false

    - name: setup PATH
      lineinfile:
        path: "/etc/environment"
        regexp: "^PATH="
        line: "PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\""
        state: "present"
      changed_when: false

    - name: disable swap
      mount:
        name: "{{ item.name }}"
        fstype: "{{ item.fstype }}"
        state: "{{ item.state }}"
      with_items:
        - { state: "absent", name: "swap", fstype: "swap" }
        - { state: "absent", name: "none", fstype: "swap" }
      changed_when: false

    - name: swapoff -a
      command: swapoff -a
      changed_when: false
      ignore_errors: true
